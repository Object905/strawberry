<!DOCTYPE html>
<html>

<head>
    <title>Strawberry GraphiQL</title>
    <style>
        body {
            height: 100%;
            margin: 0;
            width: 100%;
            overflow: hidden;
        }

        #graphiql {
            height: 100vh;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/react@16.14.0/umd/react.production.min.js"
        integrity="sha256-XO+TZ9K8q6JbdNIODhOdLPkA6RI+X94mEBruf0D2tc8=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@16.14.0/umd/react-dom.production.min.js"
        integrity="sha256-SUn04c/56KlgtEyai+cLxLsQIW600BI8phdT4JCKD4c=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.0-rc.4/dist/js.cookie.min.js"
        integrity="sha256-srkrqNQxQ5PTxynPlMErZaHbKkH7Z2slLwYPjq/dLv0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/whatwg-fetch@3.6.2/dist/fetch.umd.min.js"
        integrity="sha256-NwlBZzcvDr64kitietWUu0FLYbdgiE+YkGP5ANJJkD0=" crossorigin="anonymous"></script>

    <!-- For new subscriptions protocol -->
    <script src="https://cdn.jsdelivr.net/npm/graphql-ws@5.3.0/umd/graphql-ws.min.js"
        integrity="sha256-+Wr1pJE2beD7JgRoUsruBAqugBG/pwqdsmpaFvFzkI8=" crossorigin="anonymous"></script>

    <!-- For legacy subscriptions protocol -->
    <!-- breaking changes in subscriptions-transport-ws since 0.9.0 -->
    <script src="https://cdn.jsdelivr.net/npm/subscriptions-transport-ws@0.8.3/browser/client.js"
        integrity="sha256-BKMbTbqUpeRuFBA9qYWYe8TGy2uBpCoxnJPX1n8Vxo4=" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/graphiql@1.4.2/graphiql.min.css"
        integrity="sha256-Md3vdR7PDzWyo/aGfsFVF4tvS5/eAUWuIsg9QHUusCY=" crossorigin="anonymous">
</head>

<body>
    <div id="graphiql">Loading...</div>netlify
    <script src="https://cdn.jsdelivr.net/npm/graphiql@1.4.2/graphiql.min.js"
        integrity="sha256-zSBU/wK/odOl/StUaKnjM+ziX9NAyJOyXI0fxvb3LVo=" crossorigin="anonymous"></script>

    <script>
        var fetchURL = window.location.href;

        function httpUrlToWebSockeUrl(url) {
            return url.replace(/(http)(s)?\:\/\//, "ws$2://");
        }
        var subscriptionsEndpoint = httpUrlToWebSockeUrl(fetchURL);

        function fetcherSubscriptionParams() {
            var subscriptionsEnabled = JSON.parse('{{ SUBSCRIPTION_ENABLED }}');
            if (!subscriptionsEnabled) { return {} }

            var useGraphqlWsClient;
            try {
                useGraphqlWsClient = JSON.parse('{{ SUBSCRIPTION_GRAPHQL_WS }}');
            }
            catch {
                useGraphqlWsClient = false;
            }

            if (useGraphqlWsClient) {
                return {
                    wsClient: graphqlWs.createClient(
                        {
                            url: subscriptionsEndpoint,
                        }
                    )
                }
            } else {
                return {
                    legacyClient: new SubscriptionsTransportWs.SubscriptionClient(
                        subscriptionsEndpoint,
                        {
                            reconnect: true
                        }
                    )
                };
            }
        }

        function fetcherHeaders() {
            var headers = {
                Accept: 'application/json',
                'Content-Type': 'application/json',
            };
            var csrfToken = Cookies.get('csrftoken');
            if (csrfToken) {
                headers['x-csrftoken'] = csrfToken;
            }

            return headers;
        }


        var fetcher = GraphiQL.createFetcher({
            url: fetchURL,
            headers: fetcherHeaders(),
            ...fetcherSubscriptionParams(),
        });
        ReactDOM.render(
            React.createElement(GraphiQL, {
                fetcher: fetcher,
            }),
            document.getElementById('graphiql'),
        );
    </script>
</body>

</html>
